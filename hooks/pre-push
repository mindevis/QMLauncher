#!/bin/sh

# Pre-push hook to run quality checks

# Allow skipping checks with SKIP_PRE_PUSH_CHECKS=1
if [ "$SKIP_PRE_PUSH_CHECKS" = "1" ]; then
    echo "âš ï¸  Skipping pre-push quality checks (SKIP_PRE_PUSH_CHECKS=1)"
    exit 0
fi

echo "ğŸ” Running pre-push quality checks..."

# Run basic checks (fmt, vet, test) - skip full lint for now
if ! make fmt; then
    echo "âŒ Code formatting failed! Run 'make fmt' to fix."
    exit 1
fi

if ! make vet; then
    echo "âŒ Go vet failed! Fix the issues."
    exit 1
fi

if ! make test; then
    echo "âŒ Tests failed! Fix the test issues."
    exit 1
fi

# Optional: run lint if SKIP_LINT is not set
if [ "$SKIP_LINT" != "1" ]; then
    echo "ğŸ” Running lint checks..."
    if ! make lint 2>/dev/null; then
        echo "âš ï¸  Lint issues found, but allowing push. Run 'make lint' to see details."
        echo "ğŸ’¡ To skip lint: SKIP_LINT=1 git push"
    fi
fi

echo "âœ… Checks completed!"
exit 0
    echo "âŒ Pre-push checks failed! Please fix issues before pushing."
    echo "ğŸ’¡ Run 'make check' locally to see what needs to be fixed"
    echo "ğŸ’¡ Or run individual checks: 'make fmt', 'make vet', 'make test'"
    echo "ğŸ’¡ To skip checks: SKIP_PRE_PUSH_CHECKS=1 git push"
    exit 1
fi

echo "âœ… All checks passed! Pushing..."
exit 0